# K-Food Export Passport AI 개발일지

**날짜**: 2026-01-14

---

## 프로젝트 개요

식품 라벨 이미지를 업로드하면 OCR로 텍스트를 추출하고, 수출국별 규정 체크 및 홍보 문구를 생성하는 Streamlit 앱

---

## 작업 내역

### 1. 초기 파이프라인 구축

**생성 파일:**
- `app.py` - Streamlit 메인 앱
- `requirements.txt` - 의존성 패키지
- `src/ocr/ocr_tesseract.py` - Tesseract OCR 모듈
- `src/rules/us_fda.json` - US FDA 8대 알레르겐 규칙
- `src/rules/checker.py` - 규칙 체크 모듈
- `src/llm/promo_generator.py` - 홍보 문구 생성 (더미)

**기능:**
- 이미지 업로드 + "분석 시작" 버튼
- OCR 텍스트 추출
- 리스크 분석
- 홍보 문구 3종 (detail_copy, poster_text, buyer_pitch)

---

### 2. OCR 이미지 전처리 추가

**수정 파일:** `src/ocr/ocr_tesseract.py`

**추가 기능:**
- RGB → Grayscale 변환
- Contrast 강화 (2.5배)
- 2배 업스케일 (LANCZOS)
- 이진화 (임계값 160)
- pytesseract config: `--oem 3 --psm 6`

---

### 3. Google Vision OCR 엔진 추가

**생성 파일:** `src/ocr/ocr_google.py`

**수정 파일:**
- `requirements.txt` - google-cloud-vision 추가
- `app.py` - OCR 엔진 선택 selectbox 추가

**기능:**
- Google Vision API text_detection 호출
- OCR 엔진 선택: Google Vision (기본) / Tesseract

---

### 4. 알레르겐 자동 추출 모듈

**생성 파일:** `src/rules/allergen_parser.py`

**수정 파일:** `app.py`

**기능:**
- 13종 알레르겐 키워드 탐지
  - 밀, 대두, 계란, 우유, 돼지고기, 쇠고기, 닭고기, 새우, 게, 땅콩, 호두, 오징어, 조개
- "함유", "포함", "사용한 제품", "같은 제조 시설" 문맥 내 탐지
- 카드 UI로 표시 (st.error 스타일)

---

### 5. 영양성분 파싱 모듈

**생성 파일:** `src/rules/nutrition_parser.py`

**수정 파일:** `app.py`

**추출 대상:**
- 나트륨, 탄수화물, 당류, 지방, 트랜스지방, 포화지방, 콜레스테롤, 단백질, 칼슘

**기능:**
- 정규식으로 숫자 + 단위(mg/g) 추출
- st.dataframe으로 테이블 표시

---

### 6. 수출국 선택 및 다국가 규칙 지원

**생성 파일:**
- `src/rules/jp_food_label.json` - 일본 식품표시법
- `src/rules/vn_food_label.json` - 베트남 식품안전법

**수정 파일:**
- `src/rules/checker.py` - 국가별 규칙 로드 분기
- `app.py` - 수출국 선택 selectbox 추가

**지원 국가:**
| 코드 | 국가 | 규정 |
|------|------|------|
| US | 미국 | FDA Food Allergen Labeling (FALCPA) |
| JP | 일본 | 식품표시법 (Food Labeling Act) |
| VN | 베트남 | 식품안전법 (Decree 43/2017/ND-CP) |

---

## 현재 프로젝트 구조

```
kfood-export-passport-ai/
├── app.py
├── requirements.txt
├── 2026-01-14_개발일지.md
└── src/
    ├── __init__.py
    ├── ocr/
    │   ├── __init__.py
    │   ├── ocr_tesseract.py
    │   └── ocr_google.py
    ├── rules/
    │   ├── __init__.py
    │   ├── allergen_parser.py
    │   ├── nutrition_parser.py
    │   ├── checker.py
    │   ├── us_fda.json
    │   ├── jp_food_label.json
    │   └── vn_food_label.json
    └── llm/
        ├── __init__.py
        └── promo_generator.py
```

---

## 실행 방법

```bash
pip install -r requirements.txt
streamlit run app.py
```

---

## 의존성

```
streamlit>=1.28.0
pytesseract>=0.3.10
Pillow>=10.0.0
google-cloud-vision>=3.4.0
```

---

## 다음 작업 예정

- [ ] LLM 기반 홍보 문구 생성 (OpenAI/Claude API 연동)
- [ ] PDF 리포트 다운로드 기능
- [ ] 다국어 번역 기능
- [ ] 추가 국가 규칙 (EU, CN 등)
