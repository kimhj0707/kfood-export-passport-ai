# K-Food Export Passport AI

## Analysis Report Specification & PDF Implementation Guide

본 문서는 **K-Food Export Passport AI의 분석 리포트 고도화**를 위한
단일 기준 문서이다.

- 분석 리포트에 포함되어야 할 **정보 구조**
- AI(LLM)가 생성해야 할 **출력 형식**
- PDF 리포트로 렌더링하기 위한 **구현 지침**
  을 하나의 기준으로 통합한다.

---

## 1. 목적

현재 분석 리포트는 규정 위반 여부와 권장 사항을 간단히 제시하는 수준이다.  
본 문서는 다음을 목표로 한다.

- 규정 판단의 **근거 가시화**
- AI 분석 결과의 **투명성·신뢰성 강화**
- 사용자가 “왜 문제인지”와 “어떻게 고칠지”를 즉시 이해하도록 지원

본 리포트는 **법적·의료적 최종 판단을 수행하지 않으며**,  
공개 규정을 기반으로 한 **자동 1차 점검 결과**만을 제공한다.

---

## 2. 리포트 전체 구조 (출력 기준)

분석 리포트는 아래 **마크다운 구조를 고정적으로 유지**한다.

분석 리포트 (국가 코드) 0. 요약

1. 입력 데이터 상태
2. 규정 검토 결과
3. 수정 가이드 (Before → After)
4. 규정 근거 정보
5. 면책 문구

---

## 3. 섹션별 상세 명세

### 3.1. 0. 요약

- 최대 3줄
- 포함 내용:
  - 전체 리스크 수준 요약
  - 즉시 조치가 필요한 1순위 항목
  - 수정 시 기대 효과(통관/신뢰/홍보)

---

### 3.2. 1. 입력 데이터 상태

OCR 및 파싱 결과의 신뢰도를 사용자에게 전달한다.

예시 항목:

- OCR 신뢰도: 높음 / 중간 / 낮음 (+ 근거 1줄)
- 감지 언어
- 성분표 인식 여부
- 알레르겐 검출 여부
- 영양정보 인식 여부

정보가 없는 경우:

- `불명`
- `확인 필요`
- `추정`

으로 명시한다.

---

### 3.3. 2. 규정 검토 결과 (핵심 섹션)

각 규정 리스크는 아래 형식으로 출력된다.

⚠ [알레르겐] 우유 성분이 검출되었으나 미국 FDA 라벨링 규정에서
요구하는 알레르겐 표기가 누락되었습니다. (확신도 95%)

규정 ID: US_FDA_ALLERGEN_003
규정 설명: 해당 규정은 우유를 포함한 8가지 주요 알레르겐을
‘Contains’ 문구로 명확히 표시할 것을 요구합니다.


#### 규칙

- 기존 리스크 문구는 유지
- `rule_id`, `rule_description`이 존재할 경우에만 하단에 추가
- 규정 설명은 **1~2줄 요약 수준**
- 법 조문 전문 인용 금지

---

### 3.4. 3. 수정 가이드 (Before → After)

사용자가 바로 수정할 수 있도록 **구체적 문구 예시**를 제공한다.

[Before]
Ingredients: Wheat flour, starch, seasoning

[After]
Ingredients: Wheat flour, starch, seasoning
Contains: Wheat


- 최소 2세트 제공
- OCR 텍스트에 해당 문구가 없을 경우:
  - `(해당 문구 없음)`으로 표시

---

### 3.5. 4. 규정 근거 정보

규정의 신뢰성을 높이기 위한 **키워드 수준 근거**만 제시한다.

예시:

- US: FDA allergen “Contains” labeling
- JP: 일본 식품표시법 알레르기 27품목
- VN: 현지어 라벨 표시 요건

⚠️ 조문 전문, 해석 문단, 법률 판단 금지

---

### 3.6. 5. 면책 문구 (고정)

아래 문구는 **모든 리포트에 반드시 포함**한다.

본 결과는 공개 규정 기반의 자동 1차 점검이며,
최종 수출 적합성 판단은 전문 기관 검토가 필요합니다.


---

## 4. 데이터 구조 명세 (Upstream 규칙)

`generate_pdf_report` 함수에 전달되는 `risks` 리스트의
각 항목은 아래 구조를 따른다.

```python
{
    "severity": "HIGH",
    "risk": "우유 성분이 검출되었으나 알레르겐 표기가 누락되었습니다.",
    "confidence": 0.95,
    "rule_id": "US_FDA_ALLERGEN_003",
    "rule_description": "우유를 포함한 8대 알레르겐은 'Contains' 문구로 명확히 표기해야 합니다."
}
rule_id, rule_description은 선택 필드

존재하지 않을 경우 PDF에는 표시하지 않음

5. 구현 지침 (PDF 렌더링)
대상 파일
backend/src/report/pdf_report.py

함수: generate_pdf_report

구현 원칙
기존 레이아웃/톤 유지

규정 ID 및 설명은:

작은 폰트

muted 색상

기존 위험 메시지 하단에 배치

주의
분석 로직 수정 ❌

규정 판단 강화 ❌

출력 정보 가시화만 수행 ⭕️

6. 역할 분리 요약
구분	역할
규정 검사	rules/checker.py
데이터 구조	risks Dict
분석 리포트 구조	본 문서
PDF 시각화	pdf_report.py

7. 문서 사용 규칙
본 문서는 분석 리포트의 단일 기준 좌표로 사용한다.

임의 구조 변경, 수치 변경, 표현 변경 금지

AI 출력, PDF 구현, 발표 설명은 모두 본 문서를 기준으로 한다.

문서 끝
```
